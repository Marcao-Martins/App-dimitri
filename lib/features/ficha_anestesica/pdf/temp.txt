  static pw.Widget _buildMultiLineChart(
    String title,
    List<ParametroMonitorizacao> params,
    List<ChartLine> lines,
    double minY,
    double maxY,
  ) {
    if (params.isEmpty || lines.isEmpty) return pw.Container();

    final chartWidth = 480.0;
    final chartHeight = 100.0;
    final effectiveWidth = chartWidth - 42.0; // 36 para rótulos Y + 6 de espaçamento
    final maxIndex = params.length - 1;
    final midY = (minY + maxY) / 2;
    
    String fmt(double v) => (v % 1 == 0) ? v.toInt().toString() : v.toStringAsFixed(1);

    return pw.Column(
      crossAxisAlignment: pw.CrossAxisAlignment.start,
      children: [
        // Título e legendas
        pw.Row(
          children: [
            pw.Text(title, style: pw.TextStyle(fontSize: 9, fontWeight: pw.FontWeight.bold)),
            pw.SizedBox(width: 8),
            ...lines.map((line) => pw.Container(
              margin: const pw.EdgeInsets.only(right: 6),
              child: pw.Row(
                children: [
                  pw.Container(
                    width: 10,
                    height: 2,
                    color: line.color,
                  ),
                  pw.SizedBox(width: 2),
                  pw.Text(line.label, style: const pw.TextStyle(fontSize: 7)),
                ],
              ),
            )),
          ],
        ),
        pw.SizedBox(height: 4),

        // Rótulos Y + Gráfico
        pw.Row(
          crossAxisAlignment: pw.CrossAxisAlignment.start,
          children: [
            // Rótulos do eixo Y
            pw.Container(
              height: chartHeight,
              width: 36,
              child: pw.Column(
                mainAxisAlignment: pw.MainAxisAlignment.spaceBetween,
                crossAxisAlignment: pw.CrossAxisAlignment.end,
                children: [
                  pw.Text(fmt(maxY), style: const pw.TextStyle(fontSize: 7, color: PdfColors.grey700)),
                  pw.Text(fmt(midY), style: const pw.TextStyle(fontSize: 7, color: PdfColors.grey700)),
                  pw.Text(fmt(minY), style: const pw.TextStyle(fontSize: 7, color: PdfColors.grey700)),
                ],
              ),
            ),
            pw.SizedBox(width: 6),

            // Área do gráfico
            pw.Container(
              width: effectiveWidth,
              height: chartHeight + 20,
              child: pw.Stack(
                children: [
                  // Grade de fundo
                  pw.Positioned(
                    left: 0,
                    top: 0,
                    child: pw.Container(
                      width: effectiveWidth,
                      height: chartHeight,
                      decoration: pw.BoxDecoration(
                        border: pw.Border.all(color: PdfColors.grey300),
                      ),
                      child: pw.CustomPaint(
                        painter: (canvas, size) {
                          // Linhas horizontais
                          for (var i = 0; i <= 4; i++) {
                            final y = (i / 4) * chartHeight;
                            canvas.drawLine(0, y, effectiveWidth, y);
                            canvas.setStrokeColor(PdfColors.grey200);
                            canvas.strokePath();
                          }

                          // Eixo Y (linha vertical mais escura)
                          canvas.setStrokeColor(PdfColors.grey700);
                          canvas.setLineWidth(0.8);
                          canvas.moveTo(0, 0);
                          canvas.lineTo(0, chartHeight);
                          canvas.strokePath();
                        },
                      ),
                    ),
                  ),

                  // Linhas do gráfico
                  pw.Positioned(
                    left: 0,
                    top: 0,
                    child: pw.CustomPaint(
                      size: PdfPoint(effectiveWidth, chartHeight),
                      painter: (canvas, size) {
                        for (final line in lines) {
                          final validData = <int, double>{};
                          for (var i = 0; i < params.length; i++) {
                            final value = line.getValue(params[i]);
                            if (value != null) validData[i] = value;
                          }

                          if (validData.isNotEmpty) {
                            final entries = validData.entries.toList();

                            // Desenha linhas
                            canvas.setStrokeColor(line.color);
                            canvas.setLineWidth(1.2);
                            for (var i = 0; i < entries.length - 1; i++) {
                              final x1 = (entries[i].key / maxIndex) * effectiveWidth;
                              final y1 = chartHeight - ((entries[i].value - minY) / (maxY - minY) * chartHeight);
                              final x2 = (entries[i + 1].key / maxIndex) * effectiveWidth;
                              final y2 = chartHeight - ((entries[i + 1].value - minY) / (maxY - minY) * chartHeight);

                              canvas.moveTo(x1, y1.clamp(0, chartHeight));
                              canvas.lineTo(x2, y2.clamp(0, chartHeight));
                              canvas.strokePath();
                            }

                            // Desenha pontos
                            canvas.setFillColor(line.color);
                            for (final entry in entries) {
                              final x = (entry.key / maxIndex) * effectiveWidth;
                              final y = chartHeight - ((entry.value - minY) / (maxY - minY) * chartHeight);
                              canvas.drawEllipse(x - 1.5, y.clamp(0, chartHeight) - 1.5, 3, 3);
                              canvas.fillPath();
                            }
                          }
                        }
                      },
                    ),
                  ),

                  // Rótulos de tempo (eixo X)
                  pw.Positioned(
                    left: 0,
                    top: chartHeight + 4,
                    child: pw.Row(
                      mainAxisAlignment: pw.MainAxisAlignment.spaceBetween,
                      children: [
                        pw.SizedBox(
                          width: effectiveWidth / 2,
                          child: pw.Text(
                            '${params.first.momento.hour}:${params.first.momento.minute.toString().padLeft(2, '0')}',
                            style: const pw.TextStyle(fontSize: 7, color: PdfColors.grey600),
                          ),
                        ),
                        pw.SizedBox(
                          width: effectiveWidth / 2,
                          child: pw.Text(
                            '${params.last.momento.hour}:${params.last.momento.minute.toString().padLeft(2, '0')}',
                            style: const pw.TextStyle(fontSize: 7, color: PdfColors.grey600),
                            textAlign: pw.TextAlign.right,
                          ),
                        ),
                      ],
                    ),
                  ),
                ],
              ),
            ),
          ],
        ),
      ],
    );
  }